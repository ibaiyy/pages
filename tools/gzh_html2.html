<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./../css/common.css" rel="stylesheet" type="text/css">
    <title>Text to HTML Converter</title>
    <style>
        /* ä½¿ç”¨ flexbox å¸ƒå±€ */
        .container {
            display: flex;
        }

        .left-column {
            width: 60%;
        }

        .right-column {
            width: 40%;
        }
    </style>
</head>

<body>
<textarea id="inputText" rows="10" cols="50"
          placeholder="1äººç”Ÿå¦‚æ—…é€”ï¼Œä¸€è¾¹å†è§ï¼Œä¸€è¾¹é‡è§ã€‚2è¦ä¸ºå–œæ¬¢çš„ä¸œè¥¿å¥”è·‘ï¼Œèµ°è·¯çœŸçš„æ¥ä¸åŠã€‚3æ°¸è¿œä¸è¦æå‰ç„¦è™‘ï¼Œç”Ÿæ´»æ— éæ˜¯è§æ‹›æ‹†æ‹›ã€‚"></textarea>
<br>
<!-- æ·»åŠ è¾“å…¥æ¡†ç”¨äºè¾“å…¥æ›¿æ¢åç§° -->
<div class="row-item6">
    <label for="keepPunctuation">ä¿ç•™æ ‡ç‚¹ç¬¦å·:</label>
    <input type="checkbox" checked id="keepPunctuation">

    <button onclick="processText()" class="btn-default btn-danger">å¤„ç†æ–‡æœ¬</button>
    <button onclick="copyResult()" class="btn-default btn-primary">å¤åˆ¶ HTML ç»“æœ</button>
    <button onclick="clearInputs()" class="btn-default btn-warning">æ¸…ç©ºè¾“å…¥æ¡†</button>
</div>
<!-- æ·»åŠ ä¸€ä¸ªå®¹å™¨æ¥åŒ…å«å·¦å³ä¸¤åˆ— -->
<div class="container">
    <div class="left-column" id="resultHTML"></div>
    <div class="right-column" id="resultHTMLTXT">
        <textarea id="result_txt" rows="30" cols="50"></textarea>
    </div>
</div>

<script>
    const HTML_TEMPLATE = `<section>
    <section style="margin: 10px auto;">
        <section style="display: flex;justify-content: center;margin-bottom: 6px;">
            <section>
                <section style="display: flex;">
                    <section>
                        <section style="background-color: #7dbb91;padding: 8px 20px;box-sizing:border-box;">
                            <section style="font-size: 16px;color: #ffffff;text-align: center;">{number}</section>
                        </section>
                    </section>
                    <section style="flex-shrink: 0;display: flex;align-items: center;">
                        <section
                                style="width: 4px;height: 70%;border-right: 1px solid #7dbb91;border-top: 1px solid #7dbb91;border-bottom: 1px solid #7dbb91;box-sizing:border-box;"></section>
                    </section>
                </section>
                <section style="width: 25px; margin-left: auto; margin-top: -20px; margin-right: -10px; box-sizing: border-box; transform: rotateZ(0deg); height: 0px;"></section>
            </section>
        </section>
        <section style="background-color: #ebfaf0;padding: 10px;box-sizing:border-box;" >
            <section style="width: 100%;max-width:100% !important;box-sizing:border-box;">
                <img style="width: 100%; display: block;vertical-align:baseline;box-sizing:border-box;max-width:100% !important;"
                     src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/QuIgtW9UfDWNvuuWAUQ7g2FzEQ9cmQ5bBMiaJ2micWQPKXRaEibDDTRAuMbhsv1Wt6Z02NAYRRiawVYnlmlsL0rKvg/0?wx_fmt=jpeg"></section>
            <section style="text-align: justify;line-height:1.75em;letter-spacing: 1.5px;font-size:16px;color:#383838;background-color: transparent;padding-top: 10px;box-sizing:border-box;">
               {txt}
            </section>
        </section>
        <section style="display: flex;align-items: center;">
            <section
                    style="width: 100%;height: 1px;border-top: 1px solid #7dbb91;max-width:100% !important;box-sizing:border-box;"
                    data-width="100%"></section>
            <section style="flex-shrink: 0;">
                <section style="width: 40px; margin-left: auto; margin-bottom: -10px; margin-top: -10px; box-sizing: border-box; height: 0px;"></section>
            </section>
        </section>
    </section>
</section>`;

    const END_HTML = `<section style="text-align: center;"><span leaf="" style="font-size: 12px;color: rgb(153, 153, 153);">ç‚¹èµ åˆ†äº«&nbsp;å¹¸ç¦æ°¸è¿œğŸŒ·ç‚¹äº®&nbsp;çˆ±å¿ƒâ¤&nbsp;å¤©å¤©å¼€å¿ƒï¼</span></section>`;

    function processText() {
        const text = document.getElementById('inputText').value;
        const keepPunctuation = document.getElementById('keepPunctuation').checked;
        const result = processInputText(text, keepPunctuation);
        const aResult = [];

        result.forEach(map => {
            for (const [key, value] of Object.entries(map)) {
                const map1 = {};
                map1.number = key;
                let txt = '';
                value.forEach(line => {
                    txt += `<p style="visibility: visible;font-size: 16px; ">${line}</p>`;
                });
                map1.txt = txt;
                aResult.push(map1);
            }
        });

        let resultHTML = '';
        aResult.forEach(map => {
            let formatted = HTML_TEMPLATE;
            formatted = formatted.replace('{txt}', map.txt);
            formatted = formatted.replace('{number}', map.number);
            resultHTML += formatted;
        });

        resultHTML += END_HTML;
        document.getElementById('resultHTML').innerHTML = resultHTML;
        document.getElementById('result_txt').value = resultHTML;
    }

    function processInputText(text, keepPunctuation) {
        const allContents = [];
        // å»é™¤å…¨éƒ¨ç©ºç™½å­—ç¬¦
        text = text.replace(/\s/g, '');
        // æŒ‰ç…§æ•°å­—æ‹†åˆ†æ–‡æœ¬
        const parts = text.split(/\d+/).filter(part => part !== '');
        const numbers = text.match(/\d+/g);
        parts.forEach((part, index) => {
            processContent(allContents, part, numbers[index], keepPunctuation);
        });
        return allContents;
    }

    function processContent(allContents, content, number, keepPunctuation) {
        if (content === '') {
            return;
        }
        // æŒ‰ç…§æ ‡ç‚¹ç¬¦å·æ‹†åˆ†å¥å­
        let textLines;
        if (keepPunctuation) {
            textLines = content.split(/(?<=[ï¼Œã€‚ï¼ï¼Ÿ])/).filter(line => line !== '');
        } else {
            textLines = content.split(/[ï¼Œã€‚ï¼ï¼Ÿ]/).filter(line => line !== '');
        }
        const map = {};
        map[number] = textLines;
        allContents.push(map);
    }

    function copyResult() {
        const resultHTML = document.getElementById('resultHTML');
        const range = document.createRange();
        range.selectNodeContents(resultHTML);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        const htmlToCopy = resultHTML.innerHTML;
        const textArea = document.createElement('textarea');
        textArea.value = htmlToCopy;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);

        selection.removeAllRanges();
        alert('HTML ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
    }

    // æ–°å¢æ¸…ç©ºè¾“å…¥æ¡†çš„å‡½æ•°
    function clearInputs() {
        document.getElementById('inputText').value = '';
        document.getElementById('text1Input').value = '';
        document.getElementById('text2Input').value = '';
        document.getElementById('resultHTML').innerHTML = '';
        document.getElementById('result_txt').value = '';
    }
</script>
</body>

</html>